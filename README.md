# uButton
Очередной класс кнопки для Arduino

По API это на 99% аналог [EncButton](https://github.com/GyverLibs/EncButton), но чуточку легче и написан в более читаемом конечно-автоматном стиле, а не на флагах.

## Документация

### Дефайны настроек
Объявлять до подключения библиотеки

```cpp
#define UB_DEB_TIME 50    // дебаунс
#define UB_HOLD_TIME 600  // время до перехода в состояние "удержание"
#define UB_STEP_TIME 400  // время до перехода в состояние "импульсное удержание"
#define UB_STEP_PRD 200   // период импульсов
#define UB_CLICK_TIME 500  // ожидание кликов
#define UB_TOUT_TIME 1000  // таймаут события "таймаут"
```

### Классы

#### uButton
Ккласс uButton наследует uButtonVirt, автоматически инициализируя пин и отправляя данные с него в pollDebounce внутри tick.

```cpp
uButton(uint8_t pin, uint8_t mode = INPUT_PULLUP)
bool tick() // Вернёт true при смене состояния
```

#### uButtonVirt
Класс виртуальной кнопки.

```cpp
enum class State : uint8_t {
    Idle,          // простаивает [состояние]
    Press,         // нажатие [событие]
    Click,         // клик (отпущено до удержания) [событие]
    WaitHold,      // ожидание удержания [состояние]
    Hold,          // удержание [событие]
    ReleaseHold,   // отпущено до импульсов [событие]
    WaitStep,      // ожидание импульсов [состояние]
    Step,          // импульс [событие]
    WaitNextStep,  // ожидание следующего импульса [состояние]
    ReleaseStep,   // отпущено после импульсов [событие]
    Release,       // отпущено (в любом случае) [событие]
    WaitClicks,    // ожидание кликов [состояние]
    Clicks,        // клики [событие]
    WaitTimeout,   // ожидание таймаута [состояние]
    Timeout,       // таймаут [событие]
};
State getState() // получить текущее состояние

void reset() // сбросить системные флаги (принудительно закончить обработку)

//--------------СОБЫТИЯ---------------
// У всех событий кроме timeout есть перегрузка с аргументом uint8_t clicks - функция вернёт true, если событие "истино" и количество кликов совподает

bool press() // кнопка нажата [событие]
bool press(uint8_t clicks) // Так же и для остальных событий
bool click() // клик по кнопке (отпущена без удержания) [событие]
bool hold() // кнопка была удержана (больше таймаута) [событие]
bool releaseHold() // кнопка отпущена после удержания [событие]
bool step() // импульсное удержание [событие]
bool releaseStep() // кнопка отпущена после импульсного удержания [событие]
bool releaseHoldStep() // кнопка отпущена после удержания или импульсного удержания [событие]
bool release() // кнопка отпущена (в любом случае) [событие]
bool hasClicks() // зафиксировано несколько кликов [событие]

bool timeout() // после взаимодействия с кнопкой, мс [событие]
bool timeout(uint16_t ms)

//--------СОСТОЯНИЯ, ЗНАЧЕНИЯ---------

bool pressing() // кнопка зажата (между press() и release()) [состояние]
bool pressing(uint8_t clicks)

bool holding() // кнопка удерживается (после hold()) [состояние]
bool holding(uint8_t clicks)

bool stepping() // кнопка удерживается (после step()) [состояние]
bool stepping(uint8_t clicks)

bool waiting() // кнопка ожидает повторных кликов (между click() и hasClicks()) [состояние]
bool busy() // идёт обработка (между первым нажатием и после ожидания кликов) [состояние]

bool pressFor(uint16_t ms) // кнопка удерживается дольше чем (с начала нажатия), мс [состояние]
bool holdFor(uint16_t ms)  // кнопка удерживается дольше чем (с начала удержания), мс [состояние]
bool stepFor(uint16_t ms)  // кнопка удерживается дольше чем (с начала степа), мс [состояние]

uint16_t pressFor() // время, которое кнопка удерживается (с начала нажатия), мс
uint16_t holdFor()  // время, которое кнопка удерживается (с начала удержания), мс
uint16_t stepFor()  // время, которое кнопка удерживается (с начала степа), мс

uint8_t getClicks() // получить количество кликов

uint8_t getSteps() // получить количество степов

void pressISR() // кнопка нажата в прерывании

bool pollDebounce(bool pressed) // обработка с антидребезгом. Вернёт true при смене состояния
bool poll(bool pressed) // обработка. Вернёт true при смене состояния
```
